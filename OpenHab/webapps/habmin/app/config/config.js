/*! HABmin 2014-06-20 */
Ext.define("openHAB.config.bindingList",{extend:"Ext.panel.Panel",layout:"fit",icon:"images/chain.png",initComponent:function(){this.title=language.config_BindingListTitle,this.tabTip=language.config_BindingListTitleTip;var a=Ext.create("Ext.grid.Panel",{store:bindingStore,header:!1,columns:[{text:language.config_BindingListBundle,hideable:!1,flex:3,sortable:!0,dataIndex:"bundle"},{text:language.config_BindingListName,hideable:!1,flex:4,sortable:!0,dataIndex:"name"},{text:language.config_BindingListVersion,hideable:!1,flex:3,sortable:!0,dataIndex:"osgiVersion"}],layout:"fit",viewConfig:{stripeRows:!1,enableTextSelection:!1,markDirty:!1},listeners:{itemclick:function(a,b){if(Ext.getCmp("configPropertyContainer").removeProperty(),null!=b){var c=b.get("pid");if(""!=c){var d=Ext.create("openHAB.config.bindingProperties");null!=d&&(d.setBinding(c),Ext.getCmp("configPropertyContainer").setNewProperty(d))}}}}});this.items=a,this.callParent()}}),Ext.define("openHAB.config.bindingProperties",{extend:"Ext.panel.Panel",layout:"fit",header:!1,initComponent:function(){function a(a,b,c){var d=a;i[d]={},i[d].displayName=b,h[d]=null!=c?c:""}function b(){var b=[].concat(g.generalconfig);h=[],i=[];for(var c=0;c<b.length;c++)a(b[c].name,b[c].label,b[c].value);m.setSource(h,i)}function c(a){for(var b=0;b<g.generalconfig.length;b++)if(g.generalconfig[b].name==a)return g.generalconfig[b];for(var b=0;b<g.interfaceconfig.length;b++)if(g.interfaceconfig[b].name==a)return g.interfaceconfig[b];return null}function d(a){if(g=a,l.setText(language.config_BindingPropertiesBinding+f),null!=a.interfaceconfig?j.getComponent("add").enable():j.getComponent("add").disable(),null!=a.generalconfig&&(b(),"zwave"==f)){var c;c=Ext.create("openHAB.config.zwaveDeviceList"),n.add([c]),c=Ext.create("openHAB.config.zwaveNetwork"),n.add([c]),c=Ext.create("openHAB.config.zwaveProductList"),n.add([c])}}function e(){j.getComponent("save").disable(),j.getComponent("cancel").disable();var a=m.getSource();if(null!=a){var b={};b.pid=f,b.config=[];for(var c=Object.keys(a),e=0;e<c.length;e++){var g={};g.name=c[e],g.value=a[c[e]],b.config.push(g)}Ext.Ajax.request({url:HABminBaseURL+"/config/bindings/"+f,headers:{Accept:"application/json"},method:"PUT",jsonData:b,success:function(a){handleStatusNotification(NOTIFICATION_OK,language.config_BindingPropertiesSaved);var b=Ext.decode(a.responseText);null!=b&&d(b)},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.config_BindingPropertiesError)}})}}var f,g,h=Array(),i=Array(),j=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_BindingPropertiesCancelTip,handler:function(){b(),j.getComponent("save").disable(),j.getComponent("cancel").disable()}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!0,tooltip:language.config_BindingPropertiesSaveTip,handler:function(){e()}},{icon:"images/plus-button.png",itemId:"add",text:"Add Interface",cls:"x-btn-icon",disabled:!0,tooltip:language.config_BindingPropertiesAddTip,handler:function(){Ext.MessageBox.prompt(language.config_BindingPropertiesInterfaceName,language.config_BindingPropertiesInterfaceNamePrompt,function(b,c){if("ok"==b){-1!=c.indexOf(".")&&Ext.MessageBox(language.error,language.config_BindingPropertiesInterfaceNameError);for(var d=0;d<g.interfaceconfig.length;d++)a(c+"."+g.interfaceconfig[d].name,c+": "+g.interfaceconfig[d].label);m.setSource(h,i),j.getComponent("cancel").enable()}})}}]}),k=Ext.create("Ext.toolbar.TextItem",{text:""}),l=Ext.create("Ext.ux.StatusBar",{text:"-",items:[k]});Ext.define("BindingConfigModel",{extend:"Ext.data.Model",fields:[{name:"pid"},{name:"name"},{name:"label"},{name:"value"},{name:"description"},{name:"optional"},{name:"default"},{name:"minimum"},{name:"maximum"},{name:"options"}]});var m=Ext.create("Ext.grid.property.Grid",{title:language.properties,icon:"images/gear.png",tbar:j,bbar:l,hideHeaders:!0,sortableColumns:!1,nameColumnWidth:300,split:!0,source:h,sourceConfig:i,viewConfig:{markDirty:!1},listeners:{propertychange:function(){j.getComponent("save").enable(),j.getComponent("cancel").enable()},itemmouseenter:function(a,b){var d=b.get("name"),e=d.split("."),f=c(e[e.length-1]);null!=f&&k.setText(f.description)},itemmouseleave:function(){k.setText("")}}}),n=Ext.create("Ext.tab.Panel",{layout:"fit",border:!1,items:m});this.items=n,this.callParent(),this.setBinding=function(a){null!=a&&""!=a&&(f=a,Ext.Ajax.request({url:HABminBaseURL+"/config/bindings/"+f,timeout:5e3,method:"GET",headers:{Accept:"application/json"},success:function(a){var b=Ext.decode(a.responseText);null!=b&&d(b)}}))}}}),Ext.define("openHAB.config.config",{extend:"Ext.panel.Panel",layout:"border",id:"maintabConfig",icon:"images/gear.png",cls:"empty",initComponent:function(){this.title=language.mainTab_Configuration,this.tooltip=language.mainTab_ConfigurationTip;var a=Ext.create("openHAB.config.mappingList"),b=Ext.create("openHAB.config.sitemapList"),c=Ext.create("openHAB.config.itemList"),d=Ext.create("openHAB.config.bindingList"),e=Ext.create("Ext.Panel",{split:!0,border:!1,region:"west",width:600,stateEvents:["resize"],stateId:"configWindowSizer",stateful:!0,layout:{type:"accordion",hideCollapseTool:!0},items:[c,b,a,d]}),f=Ext.create("Ext.panel.Panel",{region:"center",id:"configPropertyContainer",header:!1,border:!1,layout:"fit",setNewProperty:function(a){this.removeAll(!0),this.add(a)},removeProperty:function(){this.removeAll(!0)}});this.items=[e,f],this.callParent()}}),Ext.define("openHAB.config.groupTree",{extend:"Ext.tree.Panel",layout:"fit",icon:"images/category-group.png",header:!1,border:!1,hideHeaders:!0,columns:[{xtype:"treecolumn",text:"Group",flex:2,dataIndex:"group",renderer:function(a,b,c){{var d=a,e=c.get("groupicon");c.get("group")}return""!=e&&(e='<img src="../images/'+e+'.png" align="left" height="16">'),e+d}}],rootVisible:!1,multiSelect:!0,viewConfig:{stripeRows:!0},initComponent:function(){function a(b,c,d){if(d++,8!=d){var e=itemConfigStore.queryBy(function(){return!0});e.each(function(e){if("GroupItem"==e.get("type")){var f=[].concat(e.get("groups"));if(-1!=f.indexOf(c)){var g=[];g.checked=!1,g.id=e.get("name"),g.group=e.get("name"),g.iconx="../images/"+e.get("icon")+".png",g.groupicon=e.get("icon"),g.children=[],a(g.children,g.group,d),g.leaf=null==g.children?!0:!1,b.push(g)}}})}}var b=this;this.title=language.config_GroupsTitle,this.tbar=Ext.create("Ext.toolbar.Toolbar",{itemId:"toolbar",items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemPropertiesCancelChangeTip,handler:function(){this.up("#itemPropertiesMain").revertItem(),b.toolbar.getComponent("cancel").disable(),b.toolbar.getComponent("save").disable()}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!1,tooltip:language.config_ItemPropertiesSaveChangeTip,handler:function(){this.up("#itemPropertiesMain").saveItem(),b.toolbar.getComponent("cancel").disable(),b.toolbar.getComponent("save").disable()}}]}),this.toolbar=this.tbar,Ext.define("GroupTree",{extend:"Ext.data.Model",fields:[{name:"checked"},{name:"group"},{name:"groupicon"}]});var c=Ext.create("Ext.data.TreeStore",{model:"GroupTree",proxy:{type:"memory"},folderSort:!0});this.store=c;var d=[];d.label="Root",d.children=[],a(d.children,"",0);c.setRootNode(d);this.expandAll(),this.callParent(),this.resetGroups=function(){this.getRootNode().cascadeBy(function(a){null!=a&&a.set("checked",!1)})},this.setGroup=function(a){var b=c.getNodeById(a);null!=b&&b.set("checked",!0)},this.getSelected=function(){var a=[];return this.getRootNode().cascadeBy(function(b){null!=b&&1==b.get("checked")&&a.push(b.get("group"))}),a}},listeners:{checkchange:function(){this.toolbar.getComponent("cancel").enable(),this.toolbar.getComponent("save").enable()}}}),Ext.define("openHAB.config.itemBindings",{extend:"Ext.panel.Panel",icon:"images/chain.png",defaults:{split:!0},border:!1,layout:"border",initComponent:function(){this.title=language.config_ItemBindingsTitle,Ext.define("ItemBindingModel",{extend:"Ext.data.Model",fields:[{name:"binding"},{name:"config"}]});var a=Ext.create("Ext.data.ArrayStore",{model:"ItemBindingModel"}),b=Ext.create("Ext.toolbar.Toolbar",{itemId:"toolbar",items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemPropertiesCancelChangeTip,handler:function(){this.up("#itemPropertiesMain").revertItem(),b.getComponent("cancel").disable(),b.getComponent("save").disable(),b.getComponent("delete").disable()}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!1,tooltip:language.config_ItemPropertiesSaveChangeTip,handler:function(){this.up("#itemPropertiesMain").saveItem(),b.getComponent("cancel").disable(),b.getComponent("save").disable(),b.getComponent("delete").disable()}},"-",{icon:"images/minus-button.png",itemId:"delete",text:language.delete,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemBindingsDeleteTip,handler:function(){var e=c.getSelectionModel().getSelection()[0];null!=e&&(a.remove(e),b.getComponent("save").enable(),b.getComponent("cancel").enable(),b.getComponent("delete").disable(),d.setProperty("String",""))}},{icon:"images/plus-button.png",itemId:"add",text:language.add,cls:"x-btn-icon",disabled:!1,tooltip:language.config_ItemBindingsAddTip,handler:function(){var c="binding";0!=a.getCount()&&(c=a.getAt(0).get("binding")),a.add({binding:c,string:language.config_ItemBindingsNewBinding}),b.getComponent("delete").enable(),b.getComponent("save").enable(),b.getComponent("cancel").enable()}}]}),c=Ext.create("Ext.grid.Panel",{store:a,region:"center",flex:1,header:!1,split:!0,collapsible:!1,multiSelect:!1,columns:[{text:language.config_ItemBindingsBinding,flex:1,dataIndex:"binding"},{text:language.config_ItemBindingsBinding,flex:4,dataIndex:"config",renderer:Ext.util.Format.htmlEncode}],listeners:{select:function(a,c){null!=c&&(d.setProperty("binding",c.get("binding")),d.setProperty("config",c.get("config")),b.getComponent("delete").enable())}}}),d=Ext.create("Ext.grid.property.Grid",{title:language.properties,region:"south",flex:1,icon:"images/gear.png",hideHeaders:!0,sortableColumns:!1,nameColumnWidth:300,split:!0,source:{binding:"",config:""},sourceConfig:{binding:{displayName:language.config_ItemBindingsDefaultName},config:{displayName:language.config_ItemBindingsDefaultString}},viewConfig:{markDirty:!1},tools:[{type:"tick",disabled:!0,tooltip:language.config_ItemBindingsUpdate,handler:function(){function a(a,b){var c=a.find("name",b);return-1!=c?a.getAt(c).get("value"):null}var e=c.getSelectionModel().getSelection()[0];if(null!=e){var f=d.getStore();e.set("binding",a(f,"binding")),e.set("config",a(f,"config")),b.getComponent("save").enable(),b.getComponent("cancel").enable(),d.getHeader().getTools()[0].disable()}}}],listeners:{propertychange:function(){d.getHeader().getTools()[0].enable()},beforeedit:function(){}}});this.items=[c,d],this.tbar=b,this.callParent(),this.setBindings=function(b){for(var c=[],d=0;d<b.length;d++)c[d]={},c[d].id=d,c[d].binding=b[d].binding,c[d].config=b[d].config;a.loadData(c)},this.getBindings=function(){var a=[],b=c.getStore();if(null==b)return a;for(var d=0;d<b.getCount();d++)a[d]={},a[d].binding=b.getAt(d).get("binding"),a[d].config=b.getAt(d).get("config");return a},this.getBindingName=function(){var a=[],b=c.getStore();return null==b?a:0==b.getCount()?"":b.getAt(0).get("binding")},this.isDirty=function(){var a=c.getStore();if(null==a)return!1;for(var b=a.getRange(),d=0;d<b.length;d++){var e=b[d];if(1==e.dirty)return!0}return!1}}}),Ext.define("openHAB.config.itemList",{extend:"Ext.panel.Panel",layout:"fit",icon:"images/document-node.png",initComponent:function(){function a(a,c,d){"yes"===a&&Ext.Ajax.request({url:HABminBaseURL+"/config/items/"+d.config.name,headers:{Accept:"application/json"},method:"DELETE",success:function(){handleStatusNotification(NOTIFICATION_OK,sprintf(language.config_ItemListDeleted,d.config.name))},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,sprintf(language.config_ItemListDeleteError,d.config.name))},callback:function(){itemConfigStore.reload(),b.getComponent("delete").disable(),Ext.getCmp("configPropertyContainer").removeProperty()}})}this.title=language.config_ItemListTitle,this.tabTip=language.config_ItemListTitleTip;var b=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/minus-button.png",itemId:"delete",text:language.delete,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemListDeleteTip,handler:function(){var b=c.getSelectionModel().getSelection()[0];if(null!=b){var d=b.get("name");Ext.Msg.show({title:language.config_ItemListConfirmDeleteTitle,msg:sprintf(language.config_ItemListConfirmDeleteMsg,d),buttons:Ext.Msg.YESNO,config:{obj:this,name:d},fn:a,icon:Ext.MessageBox.QUESTION})}}},{icon:"images/plus-button.png",itemId:"add",text:language.add,cls:"x-btn-icon",disabled:!1,tooltip:language.config_ItemListAddTip,handler:function(){Ext.define("ItemModelsModel",{extend:"Ext.data.Model",fields:[{name:"name"},{name:"icon"},{name:"iconCls"}]});var a=[],b=0,c=itemConfigStore.queryBy(function(){return!0});c.each(function(c){for(var d=!1,e=c.get("model"),f=0;f<a.length;f++)if(a[f].name==e){d=!0;break}0==d&&(a[b]={},a[b].name=e,b++)});var d=Ext.widget("form",{layout:{type:"vbox",align:"stretch"},border:!1,bodyPadding:10,fieldDefaults:{labelAlign:"top",labelWidth:100,labelStyle:"font-weight:bold"},defaults:{margins:"0 0 10 0"},items:[{margin:"0 0 0 0",xtype:"combobox",fieldLabel:language.config_ItemListModelName,itemId:"model",name:"model",store:{model:"ItemModelsModel",data:a,sorters:[{property:"name",direction:"ASC"}]},allowBlank:!1,valueField:"name",displayField:"name",forceSelection:!1,editable:!0,typeAhead:!0,queryMode:"local"}],buttons:[{text:language.cancel,handler:function(){this.up("window").destroy()}},{text:language.config_ItemListCreateItem,handler:function(){if(this.up("form").getForm().isValid()){var a=d.getForm().findField("model").getSubmitValue(),b=Ext.create("openHAB.config.itemProperties");b.createItem(a),null!=b&&Ext.getCmp("configPropertyContainer").setNewProperty(b),this.up("window").destroy()}}}]}),e=Ext.widget("window",{title:language.config_ItemListSelectModel,closeAction:"destroy",width:225,resizable:!1,draggable:!1,modal:!0,layout:{type:"vbox",align:"stretch"},items:[d]});e.show()}},{xtype:"tbfill"},{icon:"images/arrow-circle-315.png",itemId:"refresh",cls:"x-btn-icon",disabled:!1,tooltip:language.config_ItemListRefreshTip,handler:function(){itemConfigStore.load()}}]}),c=Ext.create("Ext.grid.Panel",{store:itemConfigStore,header:!1,split:!0,tbar:b,collapsible:!1,multiSelect:!1,plugins:[{ptype:"grid",emptyText:language.config_ItemListFilterDefault},{ptype:"cellediting",clicksToEdit:1}],columns:[{text:language.config_ItemListItem,flex:3,dataIndex:"name",renderer:function(a){var b="",c=itemConfigStore.findExact("name",a);return-1!=c&&""!=itemConfigStore.getAt(c).get("icon")&&(b='<img src="../images/'+itemConfigStore.getAt(c).get("icon")+'.png" align="left" height="16">'),"<div>"+b+'</div><div style="margin-left:20px">'+a+"</div>"}},{text:language.config_ItemListLabel,flex:4,dataIndex:"label",renderer:function(a,b,c){var d=persistenceItemStore.findExact("name",c.get("name"));return-1!=d&&(b.tdCls="grid-database"),a}},{text:language.config_ItemListType,flex:2,dataIndex:"type",renderer:function(a,b,c){var d="node.png";return null!=c.get("type")&&(d=getItemTypeIcon(c.get("type"))),'<img src="'+d+'" align="left" height="16">&nbsp;&nbsp;'+a}},{text:language.config_ItemListModel,flex:2,dataIndex:"model"}],listeners:{itemclick:function(a,c){if(null!=c){var d=null;d=Ext.create("openHAB.config.itemProperties"),d.setItem(c.get("name")),null!=d&&Ext.getCmp("configPropertyContainer").setNewProperty(d),b.getComponent("delete").enable()}}}});this.items=c,this.callParent()}}),Ext.define("openHAB.config.itemProperties",{extend:"Ext.panel.Panel",layout:"fit",header:!1,itemId:"itemPropertiesMain",saveOutstanding:0,saveError:!1,initComponent:function(){function a(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a.indexOf(b[c]))return!1;return!0}function b(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(null!=a[c]){for(var d=!1,e=0;e<a.length;e++)if(null!=b[e]&&a[c].binding==b[e].binding&&a[c].config==b[c].config){d=!0;break}if(0==d)return!1}return!0}this.title=language.properties,this.tabTip=language.config_ItemPropertiesTitleTip;{var c,d,e,f,g=this,h=!1,i=!1,j=!1;({ItemName:language.config_ItemPropertiesSetName,Type:language.config_ItemPropertiesSetType,Label:language.config_ItemPropertiesSetLabel,Units:language.config_ItemPropertiesSetUnits,Format:language.config_ItemPropertiesSetFormat,TranslateService:language.config_ItemPropertiesSetTransService,TranslateRule:language.config_ItemPropertiesSetTransRule,Icon:language.config_ItemPropertiesSetIcon,Groups:language.config_ItemPropertiesSetGroups,Persistence:language.config_ItemPropertiesSetPersistence})}Ext.define("PersistenceStrategyModel",{extend:"Ext.data.Model",fields:[{name:"service"},{name:"strategy"},{name:"display"}]});for(var k=Ext.create("Ext.data.ArrayStore",{model:"PersistenceStrategyModel"}),l=[],m=0,n=0;n<persistenceServiceStore.getCount();n++)for(var o=[].concat(persistenceServiceStore.getAt(n).get("strategies")),p=0;p<o.length;p++)l[m]={},l[m].name=persistenceServiceStore.getAt(n).get("name"),l[m].strategy=o[p].name,l[m].display=l[m].name+":"+l[m].strategy,m++;k.loadData(l);var q={ItemName:{displayName:language.config_ItemPropertiesItemName},Icon:{renderer:function(a){if(""==a)return"";var b="",c="",d='<div width="30">',e=itemIconStore.findExact("name",a);return-1!=e?(""!=itemIconStore.getAt(e).get("menuicon")&&(b='<img src="../images/'+itemIconStore.getAt(e).get("menuicon")+'" align="left" height="16">'),""!=itemIconStore.getAt(e).get("label")&&(c=itemIconStore.getAt(e).get("label"))):(b='<img src="../images/'+a+'.png" align="left" height="16">',c=a+" (manually set)"),d+="</div>"+a,"<div>"+b+'</div><div style="margin-left:20px">'+c+"</div>"},editor:Ext.create("Ext.form.ComboBox",{store:itemIconStore,queryMode:"local",typeAhead:!1,editable:!1,displayField:"label",valueField:"name",forceSelection:!0,allowBlank:!1,listConfig:{getInnerTpl:function(){var a='<div><img src="../images/{menuicon}" align="left" height="16">&nbsp;&nbsp;{label}</div>';return a}}})},Format:{renderer:function(a){var b="",c=itemFormatStore.findExact("format",a);return-1!=c?""!=itemFormatStore.getAt(c).get("label")&&(b=itemFormatStore.getAt(c).get("label")):b=a,b},editor:Ext.create("Ext.form.ComboBox",{store:itemFormatStore,queryMode:"local",typeAhead:!0,displayField:"label",valueField:"format",forceSelection:!1,editable:!0,allowBlank:!0})},Type:{displayName:language.config_ItemPropertiesItemType,renderer:function(a){var b=itemTypeStore.findExact("name",a);if(-1==b)return"";var c=itemTypeStore.getAt(b).get("icon");return'<img src="'+c+'" align="left" height="16">&nbsp;&nbsp;'+a},editor:Ext.create("Ext.form.ComboBox",{store:itemTypeStore,queryMode:"local",typeAhead:!1,editable:!1,displayField:"name",valueField:"name",forceSelection:!0,allowBlank:!1,listConfig:{getInnerTpl:function(){var a='<div><img src="{icon}" align="left" height="16" width:"16";>&nbsp;&nbsp;{name}</div>';return a}}})},TranslateService:{displayName:language.config_ItemPropertiesTranslationService,renderer:function(a){var b=translationServiceStore.findExact("name",a);return-1==b?"":translationServiceStore.getAt(b).get("label")},editor:Ext.create("Ext.form.ComboBox",{store:translationServiceStore,queryMode:"local",displayField:"label",valueField:"name",typeAhead:!1,editable:!1,forceSelection:!0,allowBlank:!0})},TranslateRule:{displayName:language.config_ItemPropertiesTranslationRule},Persistence:{displayName:language.config_ItemPropertiesPersistence,editor:Ext.create("Ext.form.ComboBox",{multiSelect:!0,typeAhead:!1,editable:!1,displayField:"display",valueField:"display",store:k,queryMode:"local",listeners:{expand:function(a){var b=a.getValue();1==b.length&&a.setValue(b[0].split(","))}}})},Groups:{displayName:language.config_ItemPropertiesGroups}};Ext.define("ItemIcons",{extend:"Ext.data.Model",fields:[{type:"number",name:"id"},{type:"string",name:"icon"},{type:"string",name:"name"}]});var r=Ext.create("Ext.toolbar.Toolbar",{itemId:"toolbar",items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemPropertiesCancelChangeTip,handler:function(){g.revertItem()}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemPropertiesSaveChangeTip,handler:function(){g.saveItem()}}]}),s=Ext.create("Ext.data.Store",{fields:["id","name"]}),t=[{id:0,name:"Spline"},{id:1,name:"Line"},{id:2,name:"Bar"}];s.loadData(t);var u=Ext.create("Ext.grid.property.Grid",{hideHeaders:!0,sortableColumns:!1,nameColumnWidth:300,border:!1,viewConfig:{markDirty:!0},listeners:{propertychange:function(){r.getComponent("cancel").enable(),r.getComponent("save").enable(),h=!0},beforeedit:function(a,b){var d=b.record;0==c&&"ItemName"==d.get("name")&&(b.cancel=!0),"Groups"==d.get("name")&&(b.cancel=!0)},itemmouseenter:function(a,b){b.get("name")},itemmouseleave:function(){}}}),v=Ext.create("Ext.grid.property.Grid",{hideHeaders:!0,sortableColumns:!1,nameColumnWidth:300,border:!1,viewConfig:{markDirty:!0},listeners:{propertychange:function(){r.getComponent("cancel").enable(),r.getComponent("save").enable(),i=!0},itemmouseenter:function(a,b){b.get("name")},itemmouseleave:function(){}}}),w=Ext.create("Ext.grid.property.Grid",{hideHeaders:!0,sortableColumns:!1,nameColumnWidth:300,border:!1,viewConfig:{markDirty:!0},listeners:{propertychange:function(){r.getComponent("cancel").enable(),r.getComponent("save").enable(),j=!0},itemmouseenter:function(a,b){b.get("name")},itemmouseleave:function(){}}}),x=Ext.create("Ext.panel.Panel",{title:language.properties,itemId:"itemProperties",icon:"images/gear.png",layout:{type:"vbox",align:"stretch"},tbar:r,border:!1,items:[u,w,v]}),y=Ext.create("Ext.toolbar.TextItem",{text:""}),z=Ext.create("Ext.ux.StatusBar",{text:"-",items:[y]}),A=Ext.create("openHAB.config.groupTree"),B=Ext.create("openHAB.config.itemBindings"),C=Ext.create("Ext.tab.Panel",{layout:"fit",bbar:z,border:!1,items:[x,A,B],listeners:{beforetabchange:function(b,c,e){if("itemProperties"==c.itemId){var f=A.getSelected();if(0==a([].concat(d.groups),f)){var g="";f=[].concat(f);for(var h=0;h<f.length;h++)A.setGroup(f[h]),0!=g.length&&(g+=", "),g+=f[h];u.setProperty("Groups",g)}}var i=e.getDockedComponent("toolbar"),j=i.getComponent("save").isDisabled(),k=i.getComponent("cancel").isDisabled(),l=x.getDockedComponent("toolbar"),m=B.getDockedComponent("toolbar"),n=A.getDockedComponent("toolbar");1==k?(null!=l&&l.getComponent("cancel").disable(),null!=m&&m.getComponent("cancel").disable(),null!=n&&n.getComponent("cancel").disable()):(null!=l&&l.getComponent("cancel").enable(),null!=m&&m.getComponent("cancel").enable(),null!=n&&n.getComponent("cancel").enable()),1==j?(null!=l&&l.getComponent("save").disable(),null!=m&&m.getComponent("save").disable(),null!=n&&n.getComponent("save").disable()):(null!=l&&l.getComponent("save").enable(),null!=m&&m.getComponent("save").enable(),null!=n&&n.getComponent("save").enable())}}});this.items=C,this.callParent(),this.setItem=function(a){var b=this;Ext.Ajax.request({url:HABminBaseURL+"/config/items/"+a,timeout:5e3,method:"GET",headers:{Accept:"application/json"},success:function(a){var c=Ext.decode(a.responseText);null!=c&&b.updatePrimaryItemProperties(c)}}),Ext.Ajax.request({url:HABminBaseURL+"/config/persistence/item/"+a,timeout:5e3,method:"GET",headers:{Accept:"application/json"},success:function(a){var c=Ext.decode(a.responseText);null!=c&&b.updatePersistenceItemProperties(c)}}),c=!1},this.createItem=function(a){var b={};b.model=a,b.groups="",this.updatePrimaryItemProperties(b),c=!0,b={},b.persistence="",this.updatePersistenceItemProperties(b)},this.updatePrimaryItemProperties=function(a){function b(a){return null==a?"":a}d=a,h=!1,z.setText("Item: "+a.name);var c={};c.ItemName=b(a.name),c.Type=b(a.type),c.Icon=b(a.icon),c.Label=b(a.label),c.Format=b(a.format),c.Units=b(a.units),c.TranslateService=b(a.translateService),c.TranslateRule=b(a.translateRule);var e=[];if(a.groups)var e=[].concat(a.groups);var f="";A.resetGroups();for(var g=0;g<e.length;g++)A.setGroup(e[g]),0!=f.length&&(f+=", "),f+=e[g];c.Groups=b(f),"GroupItem"==a.type&&C.remove(B,!0),u.setSource(c,q);var i=[];a.bindings&&(i=[].concat(a.bindings)),B.setBindings(i);var j=r.getComponent("cancel");j&&j.disable();var k=r.getComponent("save");k&&k.disable()},this.updateExtendedItemProperties=function(a){e=a;if(null!=a&&null!=a.rule){for(var b={},c={},d=0;d<a.rule.length;d++){var f=a.rule[d];if(null!=f&&null!=f.linkeditem&&""!=f.linkeditem)for(var g=[].concat(f.variable),h=0;h<g.length;h++)if("Setup"!=g[h].scope){var i=f.name+"."+g[h].name;b[i]=g[h].value,c[i]={},c[i].displayName=g[h].label}}v.setSource(b,c)}},this.updatePersistenceItemProperties=function(a){f=a;var b={},c="";if(null!=a.persistence)for(var d=[].concat(a.persistence),e=0;e<d.length;e++){for(var g=[].concat(d[e].itemstrategies),h=[].concat(d[e].groupstrategies),i="",j=0;j<g.length;j++)if(null!=g[j]){0!=i.length&&(i+=",");{var l=d[e].service+":"+g[j];k.findExact("display",l)}i+=l}if(""==i){for(var m=0;m<h.length;m++)null!=h[m]&&-1==g.indexOf(h)&&(0!=i.length&&(i+=","),i+=d[e].service+":"+h[m]);""!=i&&(i="group("+i+")")}c+=i}b.Persistence=c,w.setSource(b,q)},this.saveResponse=function(a){0==a&&(this.saveError=!0),this.saveOutstanding--,this.saveOutstanding>0||(0==this.saveError?handleStatusNotification(NOTIFICATION_OK,language.config_ItemPropertiesSaveOk):handleStatusNotification(NOTIFICATION_ERROR,language.config_ItemPropertiesSaveError),itemConfigStore.reload())},this.savePrimaryData=function(){var c=this,e=A.getSelected();0==a(e,[].concat(d.groups))&&(h=!0);var f=B.getBindings();if(0==b(f,[].concat(d.bindings))&&(h=!0),0==h)return!1;var g=u.getSource();return null==g?!1:(d.groups=e,d.bindings=f,d.type=g.Type,d.name=g.ItemName,d.icon=g.Icon,d.label=g.Label,d.units=g.Units,d.format=g.Format,d.translateService=g.TranslateService,d.translateRule=g.TranslateRule,Ext.Ajax.request({url:HABminBaseURL+"/config/items/"+d.name,headers:{Accept:"application/json"},method:"PUT",jsonData:d,success:function(a){c.saveResponse(!0);var b=Ext.decode(a.responseText);null!=b&&c.updatePrimaryItemProperties(b)},failure:function(){c.saveResponse(!1)}}),!0)},this.saveExtendedData=function(){var a=this;if(0==i)return!1;var b=u.getSource();if(null==b)return!1;var c=b.ItemName,b=v.getSource();if(null==b)return!1;var d={};d.rule=[];for(var f=0,g=0;g<e.rule.length;g++){var h=e.rule[g];if(null!=h&&null!=h.linkeditem&&""!=h.linkeditem){for(var j=[].concat(h.variable),k=0,l=null,m=0;m<j.length;m++)if("Setup"!=j[m].scope){var n=h.name+"."+j[m].name;null==l&&(l={},l.name=h.name,l.variable=[]),l.variable[k]={},l.variable[k].name=j[m].name,l.variable[k].value=b[n],k++}null!=l&&(d.rule[f]=l,f++)}}return 0!=f&&Ext.Ajax.request({url:HABminBaseURL+"/config/rules/item/"+c,method:"PUT",jsonData:d,headers:{Accept:"application/json"},success:function(b){a.saveResponse(!0);var c=Ext.decode(b.responseText);null!=c&&updateExtendedItemProperties(c)},failure:function(){a.saveResponse(!1)}}),!0},this.savePersistenceData=function(){var a=this;if(0==j)return!1;var b=f.item,c=w.getSource();if(null==c)return!1;if(null!=c.Persistence){var d={};d.item=b,d.persistence=[],(null==f.persistence||0==f.persistence.length)&&(f.persistence=[]);for(var e=[].concat(f.persistence),g=0;g<e.length;g++)d.persistence[g]={},d.persistence[g].service=e[g].service,d.persistence[g].itemstrategies=[];for(var g=0;g<c.Persistence.length;g++){for(var h=c.Persistence[g].split(":"),i=!1,k=0;k<d.persistence.length;k++)d.persistence[k].service==h[0]&&(d.persistence[k].itemstrategies.push(h[1]),i=!0);if(0==i){var l={};l.service=h[0],l.itemstrategies=[],l.itemstrategies.push(h[1]),d.persistence.push(l)}}return Ext.Ajax.request({url:HABminBaseURL+"/config/persistence/item/"+b,method:"PUT",jsonData:d,headers:{Accept:"application/json"},success:function(b){a.saveResponse(!0);var c=Ext.decode(b.responseText);null!=c&&a.updatePersistenceItemProperties(c)},failure:function(){a.saveResponse(!1)}}),!0}},this.saveItem=function(){var a=this;a.saveOutstanding=0,a.saveError=!1;var b=0;1==a.savePrimaryData()&&(a.saveOutstanding++,b++),1==a.savePersistenceData()&&(a.saveOutstanding++,b++),1==a.saveExtendedData()&&(a.saveOutstanding++,b++),0==b&&handleStatusNotification(NOTIFICATION_WARNING,language.config_ItemPropertiesNothingSaved),r.getComponent("cancel").disable(),r.getComponent("save").disable()},this.revertItem=function(){var a=this;a.updatePrimaryItemProperties(d)}}}),Ext.define("openHAB.config.itemRules",{extend:"Ext.panel.Panel",defaults:{split:!0},border:!1,layout:"border",icon:"images/node-design.png",initComponent:function(){this.title=language.config_ItemRulesTitle;return}}),Ext.define("openHAB.config.mappingList",{extend:"Ext.panel.Panel",layout:"fit",icon:"images/tables-relation.png",initComponent:function(){this.title=language.config_MappingListTitle,this.tabTip=language.config_MappingListTitleTip,this.callParent()}});var lookupStore;Ext.define("openHAB.config.mappingProperties",{extend:"Ext.panel.Panel",layout:"fit",header:!1,initComponent:function(){this.tabTip=language.config_MappingPropertiesTip,Ext.define("MapList",{extend:"Ext.data.Model",fields:[{name:"minimum"},{name:"maximum"},{name:"label"},{name:"colour"},{name:"icon"}]}),lookupStore=Ext.create("Ext.data.ArrayStore",{model:"MapList"});var a=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_MappingPropertiesCancelTip,handler:function(){var a=Ext.getCmp("configProperties").getStore(),b=a.getAt(1).get("value"),c=a.getAt(2).get("value");SetConfigVariableData(configDeviceId,b,c)}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!0,tooltip:language.config_MappingPropertiesSaveTip,handler:function(){SaveConfigVariableData()}},{icon:"images/plus-button.png",itemId:"add",text:language.add,cls:"x-btn-icon",disabled:!0,tooltip:language.config_MappingPropertiesAddTip,handler:function(){var a={};a.value=0,a.label=language.config_MappingPropertiesNewLabel,lookupStore.add(a)}},{icon:"images/minus-button.png",itemId:"delete",text:language.delete,cls:"x-btn-icon",disabled:!0,tooltip:language.config_MappingPropertiesDeleteTip,handler:function(){var a=Ext.getCmp("gridLookup").getView().getSelectionModel().getSelection()[0];a&&lookupStore.remove(a)}}]});this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});var b=Ext.create("Ext.grid.Panel",{xtype:"cell-editing",title:language.config_MappingPropertiesGridTitle,icon:"images/tables-relation.png",header:!1,plugins:[this.cellEditing],store:lookupStore,columns:[{header:language.config_MappingPropertiesGridMinimum,dataIndex:"minimum",width:75,editor:{allowBlank:!1}},{header:language.config_MappingPropertiesGridMaximum,dataIndex:"maximum",width:75,editor:{allowBlank:!1}},{header:language.config_MappingPropertiesGridLabel,dataIndex:"label",width:300,editor:{allowBlank:!1}},{header:language.config_MappingPropertiesGridValue,dataIndex:"value",editor:{allowBlank:!1}},{header:language.config_MappingPropertiesGridIcon,dataIndex:"icon",editor:{allowBlank:!1}}],selModel:{selType:"cellmodel"},tbar:a,listeners:{beforeedit:function(){Ext.getCmp("configLookupTb-delete").enable()},edit:function(){Ext.getCmp("configLookupTb-save").enable()}}}),c=Ext.create("Ext.tab.Panel",{layout:"fit",border:!1,items:[b]});this.items=c,this.callParent()}}),Ext.define("openHAB.config.sitemapList",{extend:"Ext.panel.Panel",layout:"fit",icon:"images/maps-stack.png",initComponent:function(){function a(a,b,c){"yes"===a&&Ext.Ajax.request({url:HABminBaseURL+"/config/sitemap/"+c.config.name,headers:{Accept:"application/json"},method:"DELETE",success:function(){handleStatusNotification(NOTIFICATION_OK,sprintf(language.config_SitemapListSitemapDeleteOk,c.config.name))
},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,sprintf(language.config_SitemapListSitemapDeleteErr,c.config.name))},callback:function(){sitemapStore.reload(),Ext.getCmp("configPropertyContainer").removeProperty(),e.getComponent("delete").disable()}})}function b(a,b){if("ok"===a){var c=f.getSelectionModel().getSelection()[0];if(null!=c){var e=c.get("name");d(b,e)}}}function c(a,b){"ok"===a&&d(b,null)}function d(a,b){if(-1!=a.indexOf("."))return void Ext.MessageBox(language.error,config_SitemapListFormatError);var c={};null!=b&&(c.copy=b),Ext.Ajax.request({url:HABminBaseURL+"/config/sitemap/"+a,headers:{Accept:"application/json"},method:"POST",params:c,success:function(){handleStatusNotification(NOTIFICATION_OK,sprintf(language.config_SitemapListSitemapCreateOk,a))},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,sprintf(language.config_SitemapListSitemapCreateErr,a))},callback:function(){sitemapStore.reload(),Ext.getCmp("configPropertyContainer").removeProperty(),e.getComponent("delete").disable(),e.getComponent("copy").disable()}})}this.title=language.config_SitemapListTitle,this.tabTip=language.config_SitemapListTitleTip;var e=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/minus-button.png",itemId:"delete",text:language.delete,cls:"x-btn-icon",disabled:!0,tooltip:language.config_SitemapListDeleteTip,handler:function(){var b=f.getSelectionModel().getSelection()[0];if(null!=b){var c=b.get("name");Ext.Msg.show({title:language.delete,msg:sprintf(language.config_SitemapListDeleteMsg,c),buttons:Ext.Msg.YESNO,config:{obj:this,name:c},fn:a,icon:Ext.MessageBox.QUESTION})}}},{icon:"images/plus-button.png",itemId:"add",text:language.add,cls:"x-btn-icon",disabled:!1,tooltip:language.config_SitemapListAddTip,handler:function(){Ext.MessageBox.prompt(language.config_SitemapListSitemapName,language.config_SitemapListNewSitemapMsg,c)}},{icon:"images/document-copy.png",itemId:"copy",text:language.copy,cls:"x-btn-icon",disabled:!0,tooltip:language.config_SitemapListCopyTip,handler:function(){Ext.MessageBox.prompt(language.config_SitemapListSitemapName,language.config_SitemapListCopySitemapMsg,b)}},{xtype:"tbfill"},{icon:"images/arrow-circle-315.png",itemId:"refresh",cls:"x-btn-icon",disabled:!1,tooltip:language.config_SitemapListRefreshTip,handler:function(){sitemapStore.load()}}]}),f=Ext.create("Ext.grid.Panel",{store:sitemapStore,header:!1,tbar:e,columns:[{text:"",hideable:!1,width:24,sortable:!0,dataIndex:"icon",renderer:function(a){return null!=a&&""!=a?'<img src="../images/'+a+'.png"  height="16">':void 0}},{text:language.config_SitemapListName,hideable:!1,flex:1,sortable:!0,dataIndex:"name"},{text:language.config_SitemapListLabel,hideable:!1,flex:2,sortable:!0,dataIndex:"label"}],layout:"fit",viewConfig:{stripeRows:!1,enableTextSelection:!1,markDirty:!1},listeners:{itemclick:function(a,b){if(null!=b){var c=Ext.create("openHAB.config.sitemapProperties"),d=b.get("name");c.setItem(d),Ext.getCmp("configPropertyContainer").setNewProperty(c),e.getComponent("delete").enable(),e.getComponent("copy").enable()}}}});this.items=f,this.callParent()}}),Ext.define("openHAB.config.sitemapProperties",{extend:"Ext.panel.Panel",layout:"fit",header:!1,initComponent:function(){function a(a){if("yes"===a){var b=o.getSelectionModel().getSelection()[0];null!=b&&(b.parentNode.removeChild(b),m.getHeader().getTools()[0].disable(),m.getHeader().getTools()[1].disable(),l.getComponent("cancel").enable(),l.getComponent("save").enable())}}function b(a){var b=[],c=e[a.get("type")];if(null!=c){for(var d=0;d<c.length;d++)if(a.get(c[d]))if("mapping"==c[d]){for(var g=a.get(c[d]),h="",k=!0,l=0;l<g.length;l++)0==k&&(h+=", "),h+=g[l].command+"="+g[l].label,k=!1;b[c[d]]=h}else b[c[d]]=a.get(c[d]);else b[c[d]]="";m.setSource(b,j),m.getHeader().getTools()[0].disable(),i.filterBy(function(b){return-1==f[a.get("type")].indexOf(b.get("type"))?!1:!0}),m.getHeader().getTools()[1].enable()}}this.tabTip=language.config_SitemapPropertiesTip;var c,d=this,e={Sitemap:["label","itemicon"],Chart:["item","label","format","units","itemicon","service","period","refresh","labelcolor","valuecolor","visibility"],Colorpicker:["item","label","format","units","itemicon","sendFrequency","labelcolor","valuecolor","visibility"],Frame:["item","label","format","units","translateService","translateRule","itemicon","labelcolor","valuecolor","visibility"],Group:["item","label","format","units","translateService","translateRule","itemicon","labelcolor","valuecolor","visibility"],Image:["label","itemicon","format","units","url","refresh","labelcolor","valuecolor","visibility"],List:["item","label","format","units","translateService","translateRule","itemicon","separator","labelcolor","valuecolor","visibility"],Switch:["item","label","format","units","translateService","translateRule","itemicon","command","mapping","labelcolor","valuecolor","visibility"],Selection:["item","label","format","units","translateService","translateRule","itemicon","mapping","labelcolor","valuecolor","visibility"],Setpoint:["item","label","format","units","translateService","translateRule","itemicon","minValue","maxValue","step","labelcolor","valuecolor","visibility"],Slider:["item","label","format","units","translateService","translateRule","itemicon","sendFrequency","switchSupport","labelcolor","valuecolor","visibility"],Text:["item","label","format","units","translateService","translateRule","itemicon","labelcolor","valuecolor","visibility"],Video:["label","format","units","url","itemicon","labelcolor","valuecolor","visibility"],Webview:["label","format","units","url","height","itemicon","labelcolor","valuecolor","visibility"]},f={Sitemap:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Chart:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Colorpicker:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Frame:["GroupItem","StringItem"],Group:["GroupItem","StringItem"],Image:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],List:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Switch:["DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Selection:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Setpoint:["NumberItem"],Slider:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Text:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Video:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"],Webview:["ColorItem","ContactItem","DateTimeItem","DimmerItem","GroupItem","NumberItem","RollershutterItem","StringItem","SwitchItem"]},g=["sitemap","Group","Text","Image","Frame"],h=({command:"?",height:language.config_SitemapHelpHeight,item:language.config_SitemapHelpItem,itemicon:language.config_SitemapHelpIcon,label:language.config_SitemapHelpLabel,format:language.config_SitemapHelpFormat,units:language.config_SitemapHelpUnits,translateService:language.config_SitemapHelpTranslateSvc,translateRule:language.config_SitemapHelpTranslateRule,mapping:language.config_SitemapHelpMapping,maxValue:language.config_SitemapHelpMax,minValue:language.config_SitemapHelpMin,period:language.config_SitemapHelpPeriod,refresh:language.config_SitemapHelpRefresh,sendFrequency:language.config_SitemapHelpFrequency,separator:language.config_SitemapHelpSeparator,service:language.config_SitemapHelpService,step:language.config_SitemapHelpStep,switchSupport:language.config_SitemapHelpSwitchSupport,url:language.config_SitemapHelpURL,visibility:language.config_SitemapHelpVisibility,labelcolor:language.config_SitemapHelpLabelColor,valuecolor:language.config_SitemapHelpValueColor},{itemicon:"icon",icon:"iconitem"}),i=Ext.create("Ext.data.ArrayStore",{model:"ItemConfigModel",proxy:{type:"rest",url:HABminBaseURL+"/config/items",reader:{type:"json",root:"item"},headers:{Accept:"application/json"},pageParam:void 0,startParam:void 0,sortParam:void 0,limitParam:void 0},autoLoad:!0}),j={item:{displayName:language.config_SitemapPropertiesItem,renderer:function(a){if(null!=a){var b="",c=i.findExact("name",a);if(-1!=c){var d=i.getAt(c).get("type");""!=d&&(c=itemTypeStore.findExact("name",d),-1!=c&&(b='<img src="'+itemTypeStore.getAt(c).get("icon")+'" align="left" height="16">'))}return"<div>"+b+'</div><div style="margin-left:20px">'+a+"</div>"}},editor:Ext.create("Ext.form.ComboBox",{store:i,queryMode:"local",typeAhead:!0,editable:!0,displayField:"name",valueField:"name",emptyText:"",forceSelection:!0,allowBlank:!0,listConfig:{getInnerTpl:function(){return'<div><tpl if="icon.length"><img height="16px" src="../images/{icon}.png"></tpl>{name}</div>'}},listeners:{beforequery:function(a){a.query=new RegExp(a.query,"i"),a.forceAll=!0}}})},itemicon:{displayName:language.config_SitemapPropertiesIcon,renderer:function(a){if(""==a||null==a)return"";var b="",c="",d='<div width="30">',e=itemIconStore.findExact("name",a);return-1!=e?(""!=itemIconStore.getAt(e).get("menuicon")&&(b='<img src="../images/'+itemIconStore.getAt(e).get("menuicon")+'" align="left" height="16">'),""!=itemIconStore.getAt(e).get("label")&&(c=itemIconStore.getAt(e).get("label"))):(b='<img src="../images/'+a+'.png" align="left" height="16">',c=a+" (manually set)"),d+="</div>"+a,"<div>"+b+'</div><div style="margin-left:20px">'+c+"</div>"},editor:Ext.create("Ext.form.ComboBox",{store:itemIconStore,queryMode:"local",typeAhead:!0,editable:!0,displayField:"label",valueField:"name",forceSelection:!0,allowBlank:!0,listConfig:{getInnerTpl:function(){var a='<div><img src="../images/{menuicon}" align="left" height="16">&nbsp;&nbsp;{label}</div>';return a}},listeners:{change:function(a,b){null===b&&this.reset()}}})},format:{displayName:language.config_SitemapPropertiesFormat,renderer:function(a){var b="",c=itemFormatStore.findExact("format",a);return-1!=c?""!=itemFormatStore.getAt(c).get("label")&&(b=itemFormatStore.getAt(c).get("label")):b=a,b},editor:Ext.create("Ext.form.ComboBox",{store:itemFormatStore,queryMode:"local",typeAhead:!0,displayField:"label",valueField:"format",forceSelection:!1,editable:!0,allowBlank:!0})},units:{displayName:language.config_SitemapPropertiesUnits},label:{displayName:language.config_SitemapPropertiesLabel},translateService:{displayName:language.config_SitemapPropertiesTranslationService,renderer:function(a){var b=translationServiceStore.findExact("name",a);return-1==b?"":translationServiceStore.getAt(b).get("label")},editor:Ext.create("Ext.form.ComboBox",{store:translationServiceStore,queryMode:"local",displayField:"label",valueField:"name",typeAhead:!1,editable:!1,forceSelection:!0,allowBlank:!0})},mapping:{displayName:language.config_SitemapPropertiesMapping},translateRule:{displayName:language.config_SitemapPropertiesTranslationRule},maxValue:{displayName:language.config_SitemapPropertiesMaximum},minValue:{displayName:language.config_SitemapPropertiesMinimum},service:{displayName:language.config_SitemapPropertiesService},step:{displayName:language.config_SitemapPropertiesStep},command:{displayName:language.config_SitemapPropertiesCommand},sendFrequency:{displayName:language.config_SitemapPropertiesSendFrequency},switchSupport:{displayName:language.config_SitemapPropertiesSwitchSupport},url:{displayName:language.config_SitemapPropertiesURL},height:{displayName:language.config_SitemapPropertiesHeight},refresh:{displayName:language.config_SitemapPropertiesRefreshPeriod}};Ext.define("SitemapTree",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"item"},{name:"label"},{name:"format"},{name:"units"},{name:"translateService"},{name:"translateRule"},{name:"type"},{name:"itemicon"},{name:"maxValue"},{name:"minValue"},{name:"step"},{name:"mapping"},{name:"leaf"},{name:"sendFrequency"},{name:"switchSupport"},{name:"height"},{name:"refresh"},{name:"service"},{name:"period"},{name:"url"},{name:"labelcolor"},{name:"valuecolor"},{name:"command"},{name:"visibility"}]});var k=Ext.create("Ext.data.TreeStore",{model:"SitemapTree",proxy:{type:"memory"},folderSort:!0}),l=Ext.create("Ext.toolbar.Toolbar",{itemId:"toolbar",items:[{icon:"images/cross.png",itemId:"cancel",text:language.cancel,cls:"x-btn-icon",disabled:!0,tooltip:language.config_ItemPropertiesCancelChangeTip,handler:function(){d.revertSitemap()}},{icon:"images/disk.png",itemId:"save",text:language.save,cls:"x-btn-icon",disabled:!0,tooltip:language.config_SitemapPropertiesSave,handler:function(){d.saveSitemap()}}]}),m=Ext.create("Ext.grid.property.Grid",{title:language.properties,icon:"images/gear.png",region:"east",flex:3,hideHeaders:!0,sortableColumns:!1,split:!0,tools:[{type:"tick",disabled:!0,tooltip:language.config_SitemapPropertiesUpdate,handler:function(){function a(a,b){var c=a.find("name",b);return-1!=c?a.getAt(c).get("value"):null}var b=o.getSelectionModel().getSelection()[0];if(null!=b){var c=m.getStore(),d=e[b.get("type")];if(null!=d)for(var f=0;f<d.length;f++){var g=a(c,d[f]);if(null==g)g="";else if("mapping"==d[f]){var h=g.split(","),i=0;if(g=[],null!=h)for(var j=0;j<h.length;j++){var k=h[j].split("=");null!=k&&2==k.length&&(g[i]={},g[i].command=k[0].trim(),g[i].label=k[1].trim(),i++)}}b.set(d[f],g)}m.getHeader().getTools()[0].disable(),l.getComponent("cancel").enable(),l.getComponent("save").enable()}}},{type:"cross",disabled:!0,tooltip:language.config_SitemapPropertiesDeleteWidget,handler:function(){Ext.Msg.show({title:language.config_SitemapPropertiesDeleteWidgetConfirm,msg:language.config_SitemapPropertiesDeleteWidgetMsg,buttons:Ext.Msg.YESNO,config:{obj:this,name:c},fn:a,icon:Ext.MessageBox.QUESTION})}}],viewConfig:{markDirty:!0},listeners:{propertychange:function(){m.getHeader().getTools()[0].enable()}}}),n=Ext.create("Ext.grid.Panel",{id:"sitemapWidgetGrid",store:widgetStore,icon:"images/document-node.png",header:!0,hideHeaders:!0,title:language.config_SitemapPropertiesWidgets,region:"center",flex:1,collapsible:!1,useArrows:!1,lines:!0,rootVisible:!1,multiSelect:!1,viewConfig:{allowCopy:!0,copy:!0,plugins:{ptype:"gridviewdragdrop",dragGroup:"sitemapSitemapTree",dropGroup:"sitemapSitemapTree",enableDrag:!0,enableDrop:!1}},columns:[{flex:1,dataIndex:"type",renderer:function(a){var b="",c=widgetStore.findExact("type",a);return-1!=c&&""!=widgetStore.getAt(c).get("icon")&&(b='<img src="'+widgetStore.getAt(c).get("icon")+'" align="left" height="16">'),"<div>"+b+'</div><div style="margin-left:20px">'+a+"</div>"}}]}),o=Ext.create("Ext.tree.Panel",{id:"sitemapSitemapTree",store:k,header:!0,title:language.config_SitemapPropertiesConfiguration,region:"south",icon:"images/maps-stack.png",flex:2,collapsible:!1,useArrows:!1,lines:!0,tools:[{type:"expand",tooltip:language.config_SitemapPropertiesExpand,handler:function(){o.expandAll()}}],rootVisible:!0,multiSelect:!1,viewConfig:{stripeRows:!0,plugins:{ptype:"treeviewdragdrop",dropGroup:"sitemapSitemapTree",dragGroup:"sitemapSitemapTree",enableDrag:!0,enableDrop:!0},listeners:{beforedrop:function(){},drop:function(a,c){var d=c.records[0];d.set("icon",""),l.getComponent("cancel").enable(),l.getComponent("save").enable(),b(d)},nodedragover:function(a,b){return"append"==b?g.indexOf(a.get("type"))?!0:!1:void 0},itemadd:function(a,b,c){o.getSelectionModel().deselectAll(!0),o.getSelectionModel().select(c,!0)}}},columns:[{xtype:"treecolumn",text:language.config_SitemapPropertiesLabelWidget,flex:2,dataIndex:"type",renderer:function(a,b,c){var d="";return""!=c.get("visibility")&&(d='<img src="images/control-power-small.png">'),"<span>"+a+'</span><span style="float:right">'+d+"</span>"}},{text:language.config_SitemapPropertiesLabelItem,flex:2,dataIndex:"item"},{text:language.config_SitemapPropertiesLabelLabel,flex:3,dataIndex:"label",renderer:function(a,b,c){var d=a,e=c.get("itemicon"),f=c.get("item"),g=itemConfigStore.findExact("name",f),h="sitemap-label-set";return-1!=g&&(""==d&&(d=itemConfigStore.getAt(g).get("label"),h="sitemap-label-default"),""==e&&(e=itemConfigStore.getAt(g).get("icon"))),""!=e&&(e='<img src="../images/'+e+'.png" align="left" height="16">'),"<div>"+e+'</div><div class="'+h+'">'+d+"</div>"}}],listeners:{itemclick:function(a,c){b(c)},itemappend:function(a,b){o.getSelectionModel().select(b,!0)}}}),p=Ext.create("Ext.toolbar.TextItem",{text:""}),q=Ext.create("Ext.ux.StatusBar",{text:"Sitemap:",items:[p]}),r=Ext.create("Ext.panel.Panel",{itemId:"sitemapPanel",title:language.properties,tbar:l,icon:"images/maps-stack.png",defaults:{split:!0},border:!1,layout:"border",items:[n,o,m]}),s=Ext.create("openHAB.config.sitemapTheme"),t=Ext.create("Ext.tab.Panel",{layout:"fit",border:!1,bbar:q,items:[r,s]});this.items=t,this.callParent(),this.setItem=function(a){Ext.Ajax.request({url:HABminBaseURL+"/config/sitemap/"+a,headers:{Accept:"application/json"},method:"GET",success:function(b){function d(a,b,c){if(null!=b&&(c++,8!=c)){b=[].concat(b);for(var f=b.length,i=0;f>i;++i){var j=[],k=e[b[i].type];if(null!=k){j.type=b[i].type;for(var l=0;l<k.length;l++){var m=k[l];null!=h[k[l]]&&(m=h[k[l]]),j[k[l]]=b[i][m]}}var n=widgetStore.findExact("type",j.type);-1!=n&&(j.iconCls=widgetStore.getAt(n).get("iconCls")),g.indexOf(b[i].type)&&(j.children=[],null!=b[i].widget&&d(j.children,b[i].widget,c)),j.leaf=null==j.children?!0:!1,a.push(j)}}}var f=Ext.decode(b.responseText);if(null!=f){c=a,q.setStatus({text:"Sitemap: "+a});var i=[];i.label=f.label,i.iconCls="sitemap-sitemap",i.type="Sitemap",i.leaf=!1,i.expanded=!0,i.children=[],d(i.children,f.widget,0),k.setRootNode(i)}}})},this.saveSitemap=function(){function a(c,d){if(d++,!(d>=9)){var f=e[c.get("type")];if(null!=f){var g={};g.type=c.get("type");for(var i=0;i<f.length;i++){var j=f[i];null!=h[f[i]]&&(j=h[f[i]]),g[j]=c.get(f[i])}if(c.hasChildNodes()){g.widget=[];for(var k=0;1e3>k;k++){var l=c.getChildAt(k);if(null==l)break;g.widget.push(a(l,d))}}else if("Frame"==g.type){var m="No Label";g.label&&g.label.length&&(m=g.label),b(sprintf(language.config_SitemapPropertiesFrameErr,m))}return g}}}function b(a){g.push(a)}if(null!=c){var d=o.getRootNode(),f={};f.name=c;var g=[];if(f.widget=a(d,0),0!=g.length){for(var i="Errors exist in the sitemap definition -:",j=0;j<g.length;j++)i+="<br>"+g[j];return void handleStatusNotification(NOTIFICATION_ERROR,i)}Ext.Ajax.request({url:HABminBaseURL+"/config/sitemap/"+c,headers:{Accept:"application/json"},method:"PUT",jsonData:f,success:function(){handleStatusNotification(NOTIFICATION_OK,language.config_SitemapPropertiesSaveOk),k.sync(),l.getComponent("cancel").disable(),l.getComponent("save").disable()},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.config_SitemapPropertiesSaveErr)}})}},this.revertSitemap=function(){}}}),Ext.define("openHAB.config.sitemapTheme",{extend:"Ext.panel.Panel",title:"Theme",icon:"images/palette-paint-brush.png",layout:"fit",header:!1,initComponent:function(){var a=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/minus-button.png",itemId:"delete",text:"Delete Item",cls:"x-btn-icon",disabled:!0,tooltip:"Delete the theme",handler:function(){}},{icon:"images/plus-button.png",itemId:"add",text:"Add New Item",cls:"x-btn-icon",disabled:!1,tooltip:"Add a new theme",handler:function(){}},{icon:"images/ui-accordion.png",itemId:"expand",text:"Expand List",cls:"x-btn-icon",disabled:!1,tooltip:"Expand all themes in the list",handler:function(){}}]}),b=Ext.create("Ext.grid.Panel",{header:!1,split:!0,requires:["Ext.grid.feature.Grouping"],features:[{ftype:"grouping",groupHeaderTpl:'{columnName}: {name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',hideGroupedHeader:!0,startCollapsed:!0,id:"themeGrouping"}],tbar:a,collapsible:!1,multiSelect:!1,columns:[{text:"Theme",flex:4,hidden:!0,dataIndex:"label"},{text:"Condition",flex:4,dataIndex:"state"},{text:"Icon",flex:1,dataIndex:"icon"},{text:"Icon Color",flex:1,dataIndex:"iconcolor"},{text:"Label Color",flex:1,dataIndex:"labelcolor"},{text:"Value Color",flex:1,dataIndex:"valuecolor"}],listeners:{select:function(){}}});this.items=b,this.callParent()}}),Ext.define("openHAB.config.zwaveDeviceList",{extend:"Ext.panel.Panel",icon:"images/application-list.png",title:language.zwave_Devices,border:!1,layout:"fit",initComponent:function(){function a(b){var c=new Array;return Ext.value(b,!1)&&b.hasChildNodes()?(b.isVisible()&&(c.push(b.get("domain")),b.eachChild(function(b){c=c.concat(a(b))})),c):[]}var b=this,c=Ext.create("Ext.toolbar.Toolbar",{items:[{icon:"images/arrow-circle-315.png",itemId:"reload",text:language.zwave_DevicesReloadButton,cls:"x-btn-icon",disabled:!1,tooltip:language.zwave_DevicesReloadButtonTip,handler:function(){var a=d.getStore();null!=a&&a.reload()}},{icon:"images/bandaid--arrow.png",itemId:"heal-all",text:language.zwave_DevicesHealButton,cls:"x-btn-icon",disabled:!1,tooltip:language.zwave_DevicesHealButtonTip,handler:function(){Ext.Ajax.request({url:HABminBaseURL+"/zwave/action/binding/network/",method:"PUT",jsonData:"Heal",headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesActionError)}})}},{icon:"images/wrench--plus.png",itemId:"include",text:language.zwave_DevicesIncludeButton,cls:"x-btn-icon",disabled:!1,tooltip:language.zwave_DevicesIncludeButtonTip,handler:function(){Ext.Ajax.request({url:HABminBaseURL+"/zwave/action/binding/network/",method:"PUT",jsonData:"Include",headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesActionError)}})}},{icon:"images/wrench--minus.png",itemId:"exclude",text:language.zwave_DevicesExcludeButton,cls:"x-btn-icon",disabled:!1,tooltip:language.zwave_DevicesExcludeButtonTip,handler:function(){Ext.Ajax.request({url:HABminBaseURL+"/zwave/action/binding/network/",method:"PUT",jsonData:"Exclude",headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesActionError)}})}},"-"]});Ext.define("ZWaveConfigModel",{extend:"Ext.data.Model",idProperty:"domain",fields:[{name:"domain",type:"string"},{name:"name",type:"string"},{name:"label",type:"string"},{name:"optional",type:"boolean"},{name:"readonly",type:"boolean"},{name:"type",type:"string"},{name:"value",type:"string"},{name:"minimum",type:"integer"},{name:"maximum",type:"integer"},{name:"state",type:"string"},{name:"description",type:"string"},{name:"valuelist"},{name:"actionlist"}]});var d=Ext.create("Ext.tree.Panel",{store:{extend:"Ext.data.TreeStore",model:"ZWaveConfigModel",autoSync:!1,clearOnLoad:!0,clearRemovedOnLoad:!0,proxy:{type:"rest",url:HABminBaseURL+"/zwave",reader:{root:"records"},headers:{Accept:"application/json"},pageParam:void 0,startParam:void 0,sortParam:void 0,limitParam:void 0},nodeParam:"domain",root:{text:"nodes",domain:"nodes/",expanded:!0},listeners:{load:function(a,b){b.eachChild(function(a){var b=a.get("domain");-1==b.indexOf("/",b.length-1)?(a.set("leaf",!0),1==a.get("readonly")?a.set("iconCls","x-config-icon-readonly"):a.set("iconCls","x-config-icon-editable")):(a.set("iconCls","x-config-icon-domain"),a.set("leaf",!1))})}}},header:!1,split:!0,tbar:c,collapsible:!1,multiSelect:!1,singleExpand:!0,rootVisible:!1,viewConfig:{stripeRows:!0,markDirty:!1},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2,listeners:{beforeedit:function(a,b){return 1==b.record.get("readonly")?!1:void 0},edit:function(a,b){if(b.originalValue!=b.value){var c=!1;if(1==c)return void handleStatusNotification(NOTIFICATION_WARNING,sprintf(language.zwave_DevicesValueUpdateRangeError,b.record.get("minimum"),b.record.get("maximum")));var d=b.record.get("domain");Ext.Ajax.request({url:HABminBaseURL+"/zwave/set/"+d,method:"PUT",jsonData:b.value,headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesValueUpdateError)}})}}}})],columns:[{text:language.zwave_DevicesTreeNode,xtype:"treecolumn",flex:1,dataIndex:"label",renderer:function(a,b,c){var d=c.get("description");""!=d&&(d=Ext.String.htmlEncode(d),b.tdAttr='data-qtip="'+d+'"');switch(c.get("state")){case"OK":b.tdCls="grid-ok";break;case"WARNING":b.tdCls="grid-warning";break;case"ERROR":b.tdCls="grid-error";break;case"INITIALIZING":b.tdCls="grid-initializing"}return a}},{text:language.zwave_DevicesTreeValue,flex:1,dataIndex:"value",renderer:function(a,b,c){if(""==a)return"";"PENDING"==c.get("state")&&(b.style="background-color: #FDFD96;border-radius: 8px;");var d=c.get("type");if("LIST"!=d)return a;var e=c.get("valuelist");if(null==e||null==e.entry)return a;for(var f=0;f<e.entry.length;f++)if(a==e.entry[f].key)return e.entry[f].value;return a},getEditor:function(a){var b=a.get("type");if("LIST"==b){Ext.define("ListComboModel",{extend:"Ext.data.Model",fields:[{name:"key"},{name:"value"}]});var c=Ext.create("Ext.data.ArrayStore",{model:"ListComboModel"}),d=a.get("valuelist");null!=d&&null!=d.entry&&c.loadData(d.entry);var e=Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.ComboBox",{store:c,editable:!1,displayField:"value",valueField:"key",queryMode:"local"})});return e.field.setEditable(!1),e.field.setValue("YYY"),e}return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Text")})}}],listeners:{select:function(a,b){for(var d=c.items.length;d>=5;d--)c.remove(c.items.get(d),!0);if(null!=b){var e=b.get("actionlist");if(null!=e&&null!=e.entry){var f=[].concat(e.entry);if(0!=f.length)for(var g=b.get("domain"),h=b.get("name"),d=0;d<f.length;d++){var i={itemId:"action"+d,icon:"images/gear-small.png",cls:"x-btn-icon",text:f[d].value,handler:function(){var a={},b=this.itemId.substring(6);a.action=f[b].key,a.name=h,Ext.Ajax.request({url:HABminBaseURL+"/zwave/action/"+g,method:"PUT",jsonData:f[b].key,headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesActionError)}})}};c.add(i)}}}},afteritemexpand:function(c){b.nodePollingTable=a(c);for(var d=c.parentNode;null!=d;)b.nodePollingTable.push(d.get("domain")),d=d.parentNode}}});this.store=d.getStore(),this.items=[d],this.callParent()},store:null,nodePollingTable:[],updateView:{run:function(){if(null!=this.nodePollingTable&&0!=this.nodePollingTable.length)for(var a=this,b=0;b<this.nodePollingTable.length;b++)Ext.Ajax.request({type:"rest",url:HABminBaseURL+"/zwave/"+this.nodePollingTable[b],method:"GET",timeout:3500,success:function(b){var c=Ext.decode(b.responseText);if(null!=c&&null!=c.records)for(var d=0;d<c.records.length;d++){var e=a.store.getNodeById(c.records[d].domain);null!=e&&(e.set("value",c.records[d].value),e.set("state",c.records[d].state))}}})},interval:5e3},listeners:{beforeshow:function(){this.updateView.scope=this,Ext.TaskManager.start(this.updateView)},beforehide:function(){Ext.TaskManager.stop(this.updateView)},beforedestroy:function(){Ext.TaskManager.stop(this.updateView)}}}),Ext.define("openHAB.config.zwaveInclud",{extend:"Ext.window.Window",closeAction:"destroy",width:750,resizable:!1,draggable:!1,modal:!0,itemId:"zwaveInclude",layout:{type:"vbox",align:"stretch"},chartId:null,initComponent:function(){this.title=language.zwave_IncludeTitle;var a=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"any",label:"Any Device"},{name:"controller",label:"Controller"},{name:"slave",label:"Slave"}]}),b=Ext.create("Ext.form.Panel",{xtype:"form",cls:"save-chart-form",title:language.graph_SaveGraphChartConfig,border:!0,bodyPadding:10,fieldDefaults:{labelAlign:"left",labelWidth:60,labelStyle:"font-weight:bold",anchor:"100%"},items:[{xtype:"combobox",name:"type",fieldLabel:language.zwave_IncludeDeviceType,store:a,allowBlank:!1,valueField:"name",displayField:"label",forceSelection:!0,editable:!1,queryMode:"local"},{xtype:"checkboxfield",name:"power",fieldLabel:language.zwave_IncludeHighPower}]});this.items=[b],this.callParent()},buttons:[{text:language.cancel,handler:function(){this.up("window").destroy()}},{text:language.save,handler:function(){0!=me.chartForm.isValid()&&Ext.Ajax.request({url:HABminBaseURL+"/zwave/action/binding/network/",method:"PUT",jsonData:"Include",headers:{Accept:"application/json"},success:function(){},failure:function(){handleStatusNotification(NOTIFICATION_ERROR,language.zwave_DevicesActionError)}})}}]}),Ext.define("openHAB.config.zwaveNetwork",{itemId:"zwaveNetworkDiagramPanel",extend:"Ext.panel.Panel",layout:"fit",icon:"images/application-list.png",title:language.zwave_Network,border:!1,networkDiagram:null,networkData:null,selectedNode:null,items:[{border:!1,itemId:"jitIsHere",id:"jitIsHere",listeners:{resize:function(a,b,c){var d=this.up("#zwaveNetworkDiagramPanel");null!=d.networkDiagram&&(d.networkDiagram.levelDistance=b/2,d.networkDiagram.canvas.resize(b,c,!0))},render:function(){var a=this.up("#zwaveNetworkDiagramPanel");a.networkDiagram=new $jit.Sunburst({injectInto:"jitIsHere-innerCt",height:400,width:400,levelDistance:160,Node:{overridable:!0,type:"gradient-multipie"},Edge:{overridable:!0,type:"hyperline",lineWidth:1,color:"#ccc"},Label:{overridable:!0,type:"Native"},NodeStyles:{enable:!0,type:"Native",stylesClick:{color:"#33dddd"},stylesHover:{color:"#dd3333"},duration:700},Tips:{enable:!0,onShow:function(b,c){var d='<div class="tip-title">'+c.name+"</div>",e=c.data;d+="<b>"+language.zwave_NetworkListening+":</b> "+e.Listening,d+="<br/><b>"+language.zwave_NetworkRouting+":</b> "+e.Routing,d+="<br/><b>"+language.zwave_NetworkPower+":</b> "+e.Power,d+="<br/><br/><u>"+language.zwave_NetworkNeighbors+"</u>";for(var f=0,g=0;g<a.networkData.length;g++)c.id===a.networkData[g].id&&(f=g);if(0==f||0==a.networkData[f].adjacencies.length)d+="<br/>None";else for(var g=0;g<a.networkData[f].adjacencies.length;g++)d+="<br/>"+a.networkData[f].adjacencies[g].nodeName;b.innerHTML=d}},Events:{enable:!0,type:"Native",onClick:function(b){b&&(a.selectedNode=b,a.networkDiagram.rotate(b,"animate",{duration:1e3,transition:$jit.Trans.Quart.easeInOut}))}},onBeforePlotLine:function(b){if(null!=a.selectedNode){for(var c=!1,d=0;d<a.networkData.length;d++)if(a.selectedNode.id===a.networkData[d].id){for(var e=0;e<a.networkData[d].adjacencies.length;e++)if(!(a.selectedNode.id!=b.nodeFrom.id&&a.selectedNode.id!=b.nodeTo.id||a.networkData[d].adjacencies[e].nodeTo!=b.nodeFrom.id&&a.networkData[d].adjacencies[e].nodeTo!=b.nodeTo.id)){c=!0;break}break}1==c?(b.data.$color="#5f5",b.data.$lineWidth=4):(delete b.data.$color,b.data.$lineWidth=1)}},onBeforePlotNode:function(){}}),a.networkDiagram.loadJSON(a.networkData),a.networkDiagram.refresh()}}}],initComponent:function(){var a=this;Ext.Ajax.request({url:HABminBaseURL+"/zwave/nodes/",method:"GET",headers:{Accept:"application/json"},success:function(b){var c=Ext.decode(b.responseText);a.networkData=[],a.networkData[0]={},a.networkData[0].id="root",a.networkData[0].adjacencies=[],a.networkData[0].data={$type:"none"};for(var d=0;d<c.records.length;d++)a.networkData[0].adjacencies[d]={},a.networkData[0].adjacencies[d].nodeTo=c.records[d].domain,a.networkData[0].adjacencies[d].data={$type:"none"};for(var d=0;d<c.records.length;d++)a.networkData[d+1]={},a.networkData[d+1].id=c.records[d].domain,a.networkData[d+1].name=c.records[d].label,a.networkData[d+1].data={$color:"#33a",$height:70},a.networkData[d+1].Label={},a.networkData[d+1].Label.color="#0f0",a.networkData[d+1].adjacencies=[],Ext.Ajax.request({url:HABminBaseURL+"/zwave/"+c.records[d].domain+"status/",method:"GET",headers:{Accept:"application/json"},success:function(b){var c=Ext.decode(b.responseText);
if(null!=c&&null!=c.records){for(var d=0,e=0;e<a.networkData.length;e++)b.request.options.url===HABminBaseURL+"/zwave/"+a.networkData[e].id+"status/"&&(d=e);if(0!=d)for(var e=0;e<c.records.length;e++)"Power"==c.records[e].name&&(a.networkData[d].data.Power=c.records[e].value),"Listening"==c.records[e].name&&(a.networkData[d].data.Listening=c.records[e].value),"Routing"==c.records[e].name&&(a.networkData[d].data.Routing=c.records[e].value),"Listening"==c.records[e].name&&"false"==c.records[e].value&&(a.networkData[d].data.$color="#bbb")}},failure:function(){}}),Ext.Ajax.request({url:HABminBaseURL+"/zwave/"+c.records[d].domain+"neighbors/",method:"GET",headers:{Accept:"application/json"},success:function(b){var c=Ext.decode(b.responseText);if(null!=c&&null!=c.records){for(var d=0,e=0;e<a.networkData.length;e++)b.request.options.url===HABminBaseURL+"/zwave/"+a.networkData[e].id+"neighbors/"&&(d=e);if(0!=d)for(var e=0;e<c.records.length;e++)a.networkData[d].adjacencies[e]={},a.networkData[d].adjacencies[e].nodeName=c.records[e].label,a.networkData[d].adjacencies[e].nodeTo="nodes/"+c.records[e].name+"/",a.networkData[d].adjacencies[e].data={$lineWidth:1,source:a.networkData[e].id}}},failure:function(){}})},failure:function(){}}),this.callParent()}}),Ext.define("openHAB.config.zwaveProductList",{extend:"Ext.panel.Panel",icon:"images/application-list.png",title:language.zwave_ProductExplorer,border:!1,layout:"fit",initComponent:function(){Ext.define("ZWaveConfigModel",{extend:"Ext.data.Model",fields:[{name:"domain",type:"string"},{name:"name",type:"string"},{name:"label",type:"string"},{name:"optional",type:"boolean"},{name:"readonly",type:"boolean"},{name:"type",type:"string"},{name:"value",type:"string"},{name:"minimum",type:"integer"},{name:"maximum",type:"integer"},{name:"state",type:"string"},{name:"description",type:"string"},{name:"valuelist"},{name:"actionlist"}]});var a=Ext.create("Ext.tree.Panel",{store:{extend:"Ext.data.TreeStore",model:"ZWaveConfigModel",clearOnLoad:!0,clearRemovedOnLoad:!0,proxy:{type:"rest",url:HABminBaseURL+"/zwave",reader:{root:"records"},headers:{Accept:"application/json"},pageParam:void 0,startParam:void 0,sortParam:void 0,limitParam:void 0},nodeParam:"domain",root:{text:"products",id:"products/",expanded:!0},listeners:{load:function(a,b){b.eachChild(function(a){var b=a.get("domain");a.set("id",b),-1==b.indexOf("/",b.length-1)?(a.set("leaf",!0),1==a.get("readonly")?a.set("iconCls","x-config-icon-readonly"):a.set("iconCls","x-config-icon-editable")):(a.set("iconCls","x-config-icon-domain"),a.set("leaf",!1))})}}},header:!1,split:!0,collapsible:!1,multiSelect:!1,singleExpand:!0,rootVisible:!1,columns:[{text:"Node",xtype:"treecolumn",flex:1,dataIndex:"label",renderer:function(a,b,c){var d=c.get("description");""!=d&&(d=Ext.String.htmlEncode(d),b.tdAttr='data-qtip="'+d+'"');switch(c.get("state")){case"OK":b.tdCls="grid-ok";break;case"WARNING":b.tdCls="grid-warning";break;case"ERROR":b.tdCls="grid-error";break;case"INITIALIZING":b.tdCls="grid-initializing"}return a}},{text:"Value",flex:1,dataIndex:"value",renderer:function(a,b,c){if(""==a)return"";var d=c.get("type");if("LIST"!=d)return a;var e=c.get("valuelist");if(null==e||null==e.entry)return a;for(var f=0;f<e.entry.length;f++)if(a==e.entry[f].key)return e.entry[f].value}}]});this.items=[a],this.callParent()}});